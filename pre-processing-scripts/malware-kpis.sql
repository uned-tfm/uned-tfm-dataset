-- KPI 1: Evolución mensual malware (conteo agrupado por mes y año)
select month, year, count(*)
from malware.malware_data_filtered
GROUP BY month, year
ORDER BY year asc, month asc;

-- KPI 2: Evolución semanal malware (conteo agrupado por semana y año)
select num_week, year, count(*)
from malware.malware_data_filtered
GROUP BY num_week, year
ORDER BY year asc, num_week asc;

-- KPI 3: Evolución malware por país y fecha (conteo agrupado por pais, semana y año)
select num_week, year, country, count(*)
from malware.malware_data_filtered
GROUP BY num_week, year, country
ORDER BY year asc, num_week asc, country asc;

-- KPI 4.1: Comparativa mensual detección malware
select month, count(*) from malware.malware_data_filtered WHERE year = 2022 and month = 3 GROUP BY month;
select month, count(*) from malware.malware_data_filtered WHERE year = 2023 and month = 4 GROUP BY month;

-- KPI 4.2: Comparativa anual detección malware
select year, count(*)
from malware.malware_data_filtered
WHERE year = 2022
GROUP BY year;
select year, count(*) from malware.malware_data_filtered WHERE year = 2023 GROUP BY year;

-- KPI 5: Top tipos malware mas comunes
SELECT malware_type, count(*) as result
FROM malware.malware_data_filtered
GROUP BY malware_type
ORDER BY count(*) DESC;

-- KPI 6: Top tipos malware agrupados por país
select country, malware_type, count(*) as result
from malware.malware_data_filtered
GROUP BY country, malware_type
ORDER BY country asc, count(*) desc;

-- KPI 7: Top tipo de malware más detectado (veces que fue registrado en la platatorma de MalwareBazaar)
select malware_type, sum(num_detections) as result
from malware.malware_data_filtered
GROUP BY malware_type
ORDER BY sum(num_detections) desc;

-- KPI 9: Métodos de distribución por país
select country, delivery_method, count(*)
from malware.malware_data_filtered
GROUP BY country, delivery_method
ORDER BY country asc, count(*) desc;

-- KPI 10: Métodos de distribución por tipo de malware
select malware_type, delivery_method, count(*)
from malware.malware_data_filtered
GROUP BY malware_type, delivery_method
ORDER BY malware_type asc, count(*) desc;

-- KPI 11: Métodos de distribución por tipo de fichero
select file_type, delivery_method, count(*)
from malware.malware_data_filtered
GROUP BY file_type, delivery_method
ORDER BY file_type asc, count(*) desc;

-- KPI 12: Tamaño medio de los ficheros por tipo de malware
select malware_type, avg(file_size) as result
from malware.malware_data_filtered
GROUP BY malware_type
ORDER BY malware_type asc, avg(file_size) desc;

-- KPI 13: Tamaño medio de los ficheros por tipo de malware
select file_type, avg(file_size) as result
from malware.malware_data_filtered
GROUP BY file_type
ORDER BY file_type asc, avg(file_size) desc;

-- KPI 14: Número de ficheros por tipo de fichero
select file_type, count(*) as result
from malware.malware_data_filtered
GROUP BY file_type
ORDER BY count(*) desc;

-- KPI 15: Tipo de fichero más comunes por tipo de malware
select malware_type, file_type, count(*) as result
from malware.malware_data_filtered
GROUP BY malware_type, file_type
ORDER BY malware_type asc, count(*) desc;